{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","server/www/src/js/classes/MobilePresentation.js","server/www/src/js/script.js","shared/js/Constants.js","shared/js/classes/slides/ContentBase.js","shared/js/classes/MobileServerBridge.js","shared/js/classes/Presentation.js","shared/js/classes/SlideBridge.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.min.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\n\tvar PresentationBase = require('shared/Presentation');\n\tvar MobileServerBridge = require('shared/MobileServerBridge');\n\t\n\tfunction MobilePresentation(data, role) {\n\t\tthis.$overlay = $('#overlay');\n\t\tPresentationBase.call(this, data, role);\n\t}\n\n\tMobilePresentation.prototype = Object.create(PresentationBase.prototype);\n\n\tMobilePresentation.prototype.createMobileServerBridge = function() {\n\t\treturn new MobileServerBridge(this, '');\n\t};\n\n\tMobilePresentation.prototype.handleMobileServerMessage = function(message) {\n\t\tif(!message.content) {\n\t\t\treturn;\n\t\t}\n\t\tif(message.content.action == 'setCurrentSlideIndex') {\n\t\t\tthis.setCurrentSlideIndex(message.content.currentSlideIndex);\n\t\t} else if(message.content.action == Constants.BLINK) {\n\t\t\tthis.blink(message.content.text, message.content.backgroundColor);\n\t\t}\n\t};\n\n\tMobilePresentation.prototype.setCurrentSlideIndex = function(index) {\n\t\tPresentationBase.prototype.setCurrentSlideIndex.call(this, index);\n\t\tthis.$overlay.removeClass('active');\n\t\tif(this.blinkInterval) {\n\t\t\tclearInterval(this.blinkInterval);\n\t\t}\n\t};\n\n\tMobilePresentation.prototype.blink = function(text, backgroundColor) {\n\t\t//overlay important, blinking text\n\t\tthis.$overlay.find('.content').html(text);\n\t\tthis.$overlay.addClass('active');\n\t\tif(this.blinkInterval) {\n\t\t\tclearInterval(this.blinkInterval);\n\t\t}\n\t\tthis.blinkInterval = setInterval(this.blinkToggle.bind(this, backgroundColor), 500);\n\t};\n\n\tMobilePresentation.prototype.blinkToggle = function(backgroundColor) {\n\t\tthis.$overlay.toggleClass('blink-on');\n\t\tif(this.$overlay.hasClass('blink-on')) {\n\t\t\tthis.$overlay.css('background-color', backgroundColor);\n\t\t} else {\n\t\t\tthis.$overlay.css('background-color', false);\n\t\t}\n\t};\n\n\treturn MobilePresentation;\n\n})();","(function(){\n\n\tvar MobilePresentation = require('./classes/MobilePresentation');\n\n\tfunction init(){\n\t\tif($('#presentation').length > 0) {\n\t\t\t//load the data.json\n\t\t\t$.get('/data.json').done(function(result){\n\t\t\t\tnew MobilePresentation(result, 'mobile');\n\t\t\t});\n\t\t}\n\t}\n\n\tinit();\n})();","module.exports = (function(){\n\n\tvar Constants = {\n\t\tGO_TO_PREVIOUS_SLIDE : 'goToPreviousSlide',\n\t\tGO_TO_NEXT_SLIDE : 'goToNextSlide',\n\t\tSET_SLIDES : 'setSlides',\n\t\tSET_CURRENT_SLIDE_INDEX : 'setCurrentSlideIndex',\n\n\t\tMESSAGE : 'message',\n\t\tSOCKET_SEND : 'socketSend',\n\t\tSOCKET_RECEIVE : 'socketReceive',\n\t\tJOIN_SLIDE_ROOM : 'joinSlideRoom',\n\t\tLEAVE_SLIDE_ROOM : 'leaveSlideRoom',\n\n\t\tROLE_PRESENTATION : 'presentation',\n\t\tROLE_MOBILE : 'mobile',\n\n\t\tSTATE_ACTIVE : 'active',\n\t\tSTATE_INACTIVE : 'inactive',\n\n\t\tSET_SUBSTATE : 'setSubstate',\n\n\t\tCHILD_APP_SAVE_CODE : 'childAppSaveCode',\n\t\tCHILD_APP_RUN_CODE : 'childAppRunCode',\n\t\tCHILD_APP_STDOUT_DATA : 'childAppStdoutData',\n\t\tCHILD_APP_STDERR_DATA : 'childAppStderrData',\n\n\t\tOPEN_COMMAND_LINE: 'openCommandLine',\n\t\tOPEN_CAMERA: 'openCamera'\n\t};\n\n\treturn Constants;\n\n})();\n","module.exports = (function(){\n\n  var Constants = require('Constants');\n\n  function ContentBase(name) {\n    this.name = name;\n    this.fps = 60;\n    this._animationFrameId = false;\n    this._currentTime = 0;\n    this._delta = 0;\n    this._interval = false;\n    this._lastTime = new Date().getTime();\n    this.currentFrame = 0;\n\n    this.startListeningForMessages();\n\n    this.__drawLoop = this._drawLoop.bind(this);\n    this._interval = 1000 / this.fps;\n  }\n\n  ContentBase.prototype.startListeningForMessages = function() {\n    this._receiveMessage = this.receiveMessage.bind(this);\n    window.addEventListener(\"message\", this._receiveMessage, false);\n  };\n\n  ContentBase.prototype.stopListeningForMessages = function() {\n    window.removeEventListener('message', this._receiveMessage);\n  };\n\n  ContentBase.prototype.receiveMessage = function(event) {\n    if(!event.data) {\n      return;\n    }\n    switch(event.data.action) {\n      case 'setState':\n        this.setState(event.data.state);\n        break;\n      case 'destroy':\n        this.destroy();\n        break;\n      case Constants.SOCKET_RECEIVE:\n        this.receiveSocketMessage(event.data.message);\n        break;\n      default:\n        this.handleMessage(event.data);\n        break;\n    }\n  };\n\n  ContentBase.prototype.destroy = function() {\n    console.log('destroy called', this.name);\n    this.stopListeningForMessages();\n    window.cancelAnimationFrame(this._animationFrameId);\n  };\n\n  ContentBase.prototype.postMessage = function(data) {\n    parent.postMessage(data, \"*\");\n  };\n\n  ContentBase.prototype.handleMessage = function(data) {\n  };\n\n  ContentBase.prototype.postSocketMessage = function(message) {\n    this.postMessage({\n      action: Constants.SOCKET_SEND,\n      message: message\n    });\n  };\n\n  ContentBase.prototype.receiveSocketMessage = function(message) {\n    //console.log('ContentBase.prototype.receiveSocketMessage ' + this.name, message);\n  };\n\n  ContentBase.prototype.setState = function(state) {\n    if(state !== this.state) {\n      this.state = state;\n      this.onStateChanged();\n      if(this.state === Constants.STATE_ACTIVE) {\n        this.currentFrame = 0;\n        this._drawLoop();\n      } else {\n        window.cancelAnimationFrame(this._animationFrameId);\n      }\n    }\n  };\n\n  ContentBase.prototype.onStateChanged = function() {\n  };\n\n  ContentBase.prototype._drawLoop = function() {\n    this._animationFrameId = window.requestAnimationFrame(this.__drawLoop);\n    this._currentTime = (new Date()).getTime();\n      this._delta = (this._currentTime - this._lastTime);\n      if(this._delta > this._interval) {\n        this.currentFrame++;\n        this.drawLoop(this._delta);\n        this._lastTime = this._currentTime - (this._delta % this._interval);\n      }\n  };\n\n  ContentBase.prototype.drawLoop = function(delta) {\n  };\n\n  return ContentBase;\n\n})();\n","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\n\tfunction MobileServerBridge(presentation, url) {\n\t\tthis.presentation = presentation;\n\t\tthis.url = url;\n\t\tthis.connect();\n\t}\n\n\tMobileServerBridge.prototype.connect = function() {\n\t\tconsole.log('MobileServerBridge.connect');\n\t\t$.post(this.url + '/login', this.getLoginCredentials()).done(this.loginHandler.bind(this))\n\t\t.fail((function() {\n\t\t\t//retry after one second\n\t\t\tsetTimeout((function(){\n\t\t\t\tthis.connect();\n\t\t\t}).bind(this), 1000);\n\t  }).bind(this));\n\t};\n\n\tMobileServerBridge.prototype.getLoginCredentials = function() {\n\t\treturn {};\n\t};\n\n\tMobileServerBridge.prototype.loginHandler = function(result) {\n\t\tthis.token = result.token;\n\t\tthis.socket = io(this.url, {\n\t\t\tquery: 'token=' + this.token,\n\t\t\treconnection: false,\n\t\t\tforceNew: true\n\t\t});\n\t\tthis.socket.on('connect', this.socketConnectHandler.bind(this));\n\t\tthis.socket.on('disconnect', this.socketDisconnectHandler.bind(this));\n\t\tthis.socket.on('message', this.socketMessageHandler.bind(this));\n\t};\n\n\tMobileServerBridge.prototype.socketConnectHandler = function() {\n\t\tconsole.log('MobileServerBridge.socketConnectHandler');\n\t\tthis.presentation.mobileServerBridgeConnected();\n\t};\n\n\tMobileServerBridge.prototype.socketDisconnectHandler = function() {\n\t\tthis.connect();\n\t};\n\n\tMobileServerBridge.prototype.tryToSend = function() {\n\t\tif(this.socket) {\n\t\t\tthis.socket.emit.apply(this.socket, arguments);\n\t\t}\n\t};\n\n\tMobileServerBridge.prototype.socketMessageHandler = function(message) {\n\t\tthis.presentation.mobileServerMessageHandler(message);\n\t};\n\n\treturn MobileServerBridge;\n})();","module.exports = (function(){\n\n  var Constants = require('Constants');\n  var SlideBridge = require('./SlideBridge');\n\n  /*\n   * data: json object with slides array property\n   * role: mobile or presentation\n   */\n  function Presentation(data, role) {\n    this.data = data;\n    this.role = role;\n    this.currentSlideIndex = -1;\n    this.slideHolders = [];\n    this.numSlideHolders = 3;\n    this.slideBridges = [];\n    this.slideBridgesBySlideName = {};\n\n    this.createSlideHolders();\n    this.createSlideBridges(this.data);\n\n    this.mobileServerBridge = this.createMobileServerBridge();\n    this.startListeningForMessages();\n\n    this.setCurrentSlideIndex(0);\n  }\n\n  Presentation.prototype.startListeningForMessages = function() {\n    window.addEventListener(\"message\", this.slideMessageHandler.bind(this), false);\n  };\n\n  Presentation.prototype.createSlideHolders = function() {\n    for(var i = 0; i < this.numSlideHolders; i++) {\n      var $slideHolder = $('<iframe class=\"slide-frame\" />');\n      this.slideHolders.push($slideHolder);\n      $('#presentation').append($slideHolder);\n    }\n  };\n\n  Presentation.prototype.createSlideBridges = function(data) {\n    var that = this;\n    var numSlides = data.slides.length;\n    for(var i = 0; i < numSlides; i++) {\n      var slideBridge = this.createSlideBridge(data.slides[i]);\n      this.slideBridges.push(slideBridge);\n      this.slideBridgesBySlideName[slideBridge.name] = slideBridge;\n    }\n  };\n\n  Presentation.prototype.createSlideBridge = function(slide) {\n    return new SlideBridge(slide);\n  };\n\n  Presentation.prototype.slideMessageHandler = function(event) {\n    if(!event.data) {\n      return;\n    }\n    switch(event.data.action) {\n      case Constants.SOCKET_SEND:\n        if(this.mobileServerBridge) {\n          this.mobileServerBridge.tryToSend(Constants.MESSAGE, event.data.message);\n        }\n        break;\n    }\n  };\n\n  Presentation.prototype.mobileServerBridgeConnected = function() {\n    //join the rooms of the slideHolders\n    for(var i = 0; i < this.numSlideHolders; i++) {\n      this.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(this.slideHolders[i]).attr('data-name'));\n    }\n  };\n\n  Presentation.prototype.mobileServerMessageHandler = function(message) {\n    if(message.target.slide) {\n      //slide has to handle the message\n      var slideBridge = this.getSlideBridgeByName(message.target.slide);\n      if(slideBridge) {\n        slideBridge.tryToPostMessage({\n          action: Constants.SOCKET_RECEIVE,\n          message: message\n        });\n      }\n    } else {\n      //presentation has to handle the message\n      this.handleMobileServerMessage(message);\n    }\n  };\n\n  Presentation.prototype.handleMobileServerMessage = function(message) {\n    console.log('[shared/Presentation] handleMobileServerMessage', message);\n  };\n\n  Presentation.prototype.getSlideBridgeByIndex = function(index) {\n    if(index >= 0 && index < this.slideBridges.length) {\n      return this.slideBridges[index];\n    }\n    return false;\n  };\n\n  Presentation.prototype.getSlideBridgeByName = function(slideName) {\n    return this.slideBridgesBySlideName[slideName];\n  };\n\n  Presentation.prototype.getSlideHolderForSlide = function(slide, slidesNotToClear) {\n    if(slide) {\n      var $slideHolder = $('.slide-frame[data-name=\"' + slide.name + '\"]');\n      if($slideHolder.length > 0) {\n        return $slideHolder[0];\n      }\n      //get a free slideHolder\n      var slideNamesNotToClear = [];\n      $(slidesNotToClear).each(function(index, obj){\n        slideNamesNotToClear.push(obj.name);\n      });\n      var $slideHolders = $('.slide-frame');\n      for (var i = $slideHolders.length - 1; i >= 0; i--) {\n        $slideHolder = $($slideHolders[i]);\n        var name = $slideHolder.attr('data-name');\n        if(!name || slideNamesNotToClear.indexOf(name) === -1) {\n          return $slideHolder[0];\n        }\n      }\n    }\n    return false;\n  };\n\n  Presentation.prototype.goToPreviousSlide = function() {\n    this.setCurrentSlideIndex(this.currentSlideIndex - 1);\n  };\n\n  Presentation.prototype.goToNextSlide = function() {\n    this.setCurrentSlideIndex(this.currentSlideIndex + 1);\n  };\n\n  Presentation.prototype.setCurrentSlideIndex = function(value) {\n    value = Math.max(0, Math.min(value, this.slideBridges.length - 1));\n    if(value !== this.currentSlideIndex) {\n      this.currentSlideIndex = value;\n\n      var currentSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex);\n      var previousSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex - 1);\n      var nextSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex + 1);\n\n      //remove \"used\" class from slide holders\n      $('.slide-frame').removeAttr('data-used', false);\n\n      var currentSlideHolder = this.getSlideHolderForSlide(currentSlideBridge, [previousSlideBridge, nextSlideBridge]);\n      this.setupSlideHolder(currentSlideHolder, currentSlideBridge, Constants.STATE_ACTIVE, 0);\n\n      var previousSlideHolder = this.getSlideHolderForSlide(previousSlideBridge, [currentSlideBridge, nextSlideBridge]);\n      this.setupSlideHolder(previousSlideHolder, previousSlideBridge, Constants.STATE_INACTIVE, '-100%');\n\n      var nextSlideHolder = this.getSlideHolderForSlide(nextSlideBridge, [previousSlideBridge, currentSlideBridge]);\n      this.setupSlideHolder(nextSlideHolder, nextSlideBridge, Constants.STATE_INACTIVE, '100%');\n\n      //clear attributes of unused slide frames\n      $('.slide-frame').each(function(index, slideHolder){\n        if(!$(slideHolder).attr('data-used')) {\n          console.log('clear slide holder');\n          $(slideHolder).removeAttr('data-used').removeAttr('data-name').removeAttr('data-src');\n        }\n      });\n\n      //all other slideHolder bridges should be unlinked from their slideHolder\n      this.slideBridges.forEach(function(slideBridge){\n        if(slideBridge === currentSlideBridge) {\n          return;\n        }\n        if(slideBridge === previousSlideBridge) {\n          return;\n        }\n        if(slideBridge === nextSlideBridge) {\n          return;\n        }\n        slideBridge.slideHolder = null;\n      });\n\n      bean.fire(this, Constants.SET_CURRENT_SLIDE_INDEX, [this.currentSlideIndex]);\n    }\n  };\n\n  Presentation.prototype.setupSlideHolder = function(slideHolder, slideBridge, state, left) {\n    if(slideHolder) {\n      var src = \"slides/\" + slideBridge.name + '.html';\n      if(slideBridge.data[this.role] && slideBridge.data[this.role].url) {\n        src = slideBridge.data[this.role].url;\n      }\n      src = this.processSlideSrc(src);\n      if(slideBridge.isAlreadyCorrectlyAttached(slideHolder, src)) {\n        //console.log(slideBridge.name + ' already attached');\n      } else {\n        this.attachToSlideHolder(slideHolder, slideBridge, src);\n      }\n      slideBridge.setState(state);\n      $(slideHolder).css('left', left);\n      $(slideHolder).attr('data-used', 1);\n    }\n  };\n\n  Presentation.prototype.attachToSlideHolder = function(slideHolder, slideBridge, src) {\n    //leave previous channel of this slideHolder\n    if(this.mobileServerBridge) {\n      this.mobileServerBridge.tryToSend(Constants.LEAVE_SLIDE_ROOM, $(slideHolder).attr('data-name'));\n    }\n    //add the join as a callback for the onload event\n    slideBridge.attachToSlideHolder(slideHolder, src, this.slideLoaded.bind(this, slideHolder, slideBridge, src));\n  };\n\n  Presentation.prototype.slideLoaded = function(slideHolder, slideBridge) {\n    //join new channel\n    if(this.mobileServerBridge) {\n      this.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(slideHolder).attr('data-name'));\n    }\n  };\n\n  Presentation.prototype.processSlideSrc = function(src) {\n    return src;\n  };\n\n  Presentation.prototype.createMobileServerBridge = function() {\n    //to implement in extending classes\n  };\n\n  return Presentation;\n\n})();\n","module.exports = (function(){\n\tfunction getIframeWindow(iframe_object) {\n\t\tvar doc;\n\n\t\tif (iframe_object.contentWindow) {\n\t\t\treturn iframe_object.contentWindow;\n\t\t}\n\n\t\tif (iframe_object.window) {\n\t\t\treturn iframe_object.window;\n\t\t}\n\n\t\tif (!doc && iframe_object.contentDocument) {\n\t\t\tdoc = iframe_object.contentDocument;\n\t\t}\n\n\t\tif (!doc && iframe_object.document) {\n\t\t\tdoc = iframe_object.document;\n\t\t}\n\n\t\tif (doc && doc.defaultView) {\n\t\t return doc.defaultView;\n\t\t}\n\n\t\tif (doc && doc.parentWindow) {\n\t\t\treturn doc.parentWindow;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfunction SlideBridge(data) {\n\t\tthis.data = data;\n\t\tthis.name = this.data.name;\n\t}\n\n\tSlideBridge.prototype.isAlreadyCorrectlyAttached = function(slideHolder, src) {\n\t\treturn (this.slideHolder === slideHolder && $(slideHolder).attr('data-name') === this.name && $(slideHolder).attr('data-src') === src);\n\t};\n\n\tSlideBridge.prototype.attachToSlideHolder = function(slideHolder, src, cb) {\n\t\t//notify the content it is being cleared\n\t\tthis.tryToPostMessage({action: 'destroy'});\n\t\tthis.slideHolder = slideHolder;\n\t\t$(slideHolder).off('load');\n\t\t$(slideHolder).attr('data-name', this.name);\n\t\t$(slideHolder).addClass('loading');\n\t\tif(src !== $(slideHolder).attr('data-src')) {\n\t\t\t$(slideHolder).on('load', (function(event){\n\t\t\t\t$(slideHolder).removeClass('loading');\n\t\t\t\tthis.tryToPostMessage({\n\t\t\t\t\taction: 'setState',\n\t\t\t\t\tstate: this.state\n\t\t\t\t});\n\t\t\t\tcb();\n\t\t\t}).bind(this));\n\t\t\t$(slideHolder).attr('data-src', src);\n\t\t\t$(slideHolder).attr('src', src);\n\t\t}\n\t};\n\n\tSlideBridge.prototype.setState = function(state) {\n\t\tthis.state = state;\n\t\tthis.tryToPostMessage({\n\t\t\taction: 'setState',\n\t\t\tstate: this.state\n\t\t});\n\t};\n\n\tSlideBridge.prototype.tryToPostMessage = function(message) {\n\t\tif(!this.slideHolder) {\n\t\t\treturn;\n\t\t}\n\t\tvar w = getIframeWindow(this.slideHolder);\n\t\tif(w) {\n\t\t\tw.postMessage(message, \"*\");\n\t\t}\n\t};\n\n\treturn SlideBridge;\n})();\n"]}