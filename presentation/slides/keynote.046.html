<template>
  <article class="slide">
    <div class="slide-content">
      <div class="live-code" data-entry-path="demos/leap-basic-websockets" data-output-path="tmp/leap-basic-websockets">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item"><a class="nav-link" href="#" aria-controls="script.js" role="tab">script.js</a></li>
          <li class="nav-item"><a class="nav-link" href="#" aria-controls="output" role="tab">output</a></li>
        </ul>
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane" data-tab-id="script.js" style="height: 66rem; position: relative;">
            <textarea data-type="code" data-mode="javascript" data-language="javascript" data-file="script.js"></textarea>
            <div class="btn-group" role="group" style="position: absolute; top: 1em; right: 1em; z-index: 10;">
              <button type="button" data-target="script.js" data-type="reload-button" class="btn btn-secondary"><i class="fa fa-4x fa-refresh"></i></button>
              <button type="button" data-target="script.js" data-type="save-button" class="btn btn-secondary"><i class="fa fa-4x fa-save"></i></button>
              <button type="button" data-target="web-preview" data-type="run-button" class="btn btn-secondary"><i class="fa fa-4x fa-play"></i></button>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane" data-tab-id="output" style="height: 66rem; position: relative;">
            <div style="height: 1px">
              <div data-id="web-preview" data-type="web-preview" data-console="web-preview-console" data-file="index.html"></div>
            </div>
            <div data-id="web-preview-console" style="height: 100%" data-type="console"></div>
          </div>
        </div>
      </div>
    </div>
<script type="text/template">
(function($slideHolder){

  var LiveCodeSlide = require('LiveCodeSlide').default;

  function init() {
    var liveCode = new LiveCodeSlide($slideHolder);

    //manual manage tabs, as we don't want to work with element ids
    $slideHolder.find('a[role=tab]').click(function (e) {
      e.preventDefault();
      var tabId = $(e.target).attr('aria-controls');
      var $tab = $slideHolder.find('[data-tab-id="' + tabId + '"]');
      $slideHolder.find(".nav-tabs .active, .tab-content .active").removeClass("active");
      $(e.target).addClass('active');
      $tab.addClass("active");
      liveCode.layout();
    });

    //focus webpreview tab on run click
    $slideHolder.find('[data-type="run-button"]').on('click', function(){
      $slideHolder.find('a[role=tab][aria-controls=output]').click();
    });

    requestAnimationFrame(function(){
      $slideHolder.find('a[role=tab]').first().click();
    });
  }

  init();

})(document.$slideHolder);
</script><img onLoad="var s = document.createElement('script'); s.innerHTML = this.previousSibling.innerHTML; document.$slideHolder = $(this).closest('.slide-frame'); this.parentNode.appendChild(s);" style="display: none;" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>
  </article>
</template>
