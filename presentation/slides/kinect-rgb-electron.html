<template>
<!-- Nav tabs -->
<ul class="nav nav-tabs" role="tablist">
	<li role="presentation"><a href="#" aria-controls="html" role="tab">HTML</a></li>
	<li role="presentation"><a href="#" aria-controls="output" role="tab">Output</a></li>
</ul>

<!-- Tab panes -->
<div class="tab-content" style="position: absolute; width: 100%; top: 62px; bottom: 0;">
	<div role="tabpanel" class="tab-pane" data-tab-id="html" style="height: 100%;">
		<textarea data-id="html-code" data-type="code" data-runtime="web" data-mode="htmlmixed" data-language="html" data-processor="web-preview"><!DOCTYPE html>
<html>
	<head>
		<title>Hello World!</title>
		<style>
		html, head {
			height: 100%;
		}
		#toggleFeedButton {
			position: absolute;
			top: 0;
			left: 0;
		}
		#outputCanvas {
			width: 100%;
		}
		</style>
	</head>
	<body>
		<button id="toggleFeedButton" disabled="disabled">Stop Video</button>
		<canvas id="outputCanvas" width="1920" height="1080"></canvas>
		<script>
		(function(){
			var Kinect2 = require('kinect2');
			var kinect = new Kinect2();

			var canvas = document.getElementById('outputCanvas');
			var ctx = canvas.getContext('2d');
			var imageData = ctx.createImageData(canvas.width, canvas.height);
			var imageDataSize = imageData.data.length;
			var imageDataArray = imageData.data;;

			var toggleFeedButton = document.getElementById('toggleFeedButton');

			var feedOpen = false;
			var processing = false;

			function setFeedOpen(value) {
				if(value !== feedOpen) {
					feedOpen = value;
					if(feedOpen) {
						toggleFeedButton.innerHTML = 'Stop Video';
						kinect.openColorReader();
					} else {
						toggleFeedButton.innerHTML = 'Start Video';
						kinect.closeColorReader();
					}
				}
			}

			if(kinect.open()) {
				console.log('kinect open');
				kinect.on('colorFrame', function(newPixelData){
					if(processing) {
						return;
					}
					console.log('color frame');
					processing = true;
					for (var i = 0; i < imageDataSize; i++) {
						imageDataArray[i] = newPixelData[i];
					}
					ctx.putImageData(imageData, 0, 0);
					processing = false;
				});

				toggleFeedButton.addEventListener('click', function(){
					setFeedOpen(!feedOpen);
				});

				toggleFeedButton.removeAttribute('disabled');

				setFeedOpen(true);
			}
		})();
		</script>
	</body>
</html></textarea>
		<button class="btn btn-default" data-type="run-button" data-target="html-code" style="position: absolute; top: 1em; right: 1em; z-index: 10">Run</button>
	</div>
	<div role="tabpanel" class="tab-pane" data-tab-id="output" style="height: 100%;">
		<div class="split-pane fixed-bottom">
			<div class="split-pane-component top-pane" style="bottom: 10em; margin-bottom: 5px; min-height: 5em;">
				<div data-id="web-preview" data-type="web-preview" data-console="web-preview-console"></div>
			</div>
			<div class="split-pane-divider divider" style="background: #aaa; bottom: 10em; height: 5px;"></div>
			<div class="split-pane-component bottom-pane" style="height: 10em; min-height: 10em;">
				<div data-id="web-preview-console" style="height: 100%" data-type="console"></div>
			</div>
		</div>
	</div>
</div>
<script>
(function(){

	var LiveCode = require('slides/LiveCode');
	var $slideHolder = $(document.currentScript).closest('.slide-frame');

	function init() {
		var liveCode = new LiveCode($slideHolder);

		//manual manage tabs, as we don't want to work with element ids
		$slideHolder.find('a[role=tab]').click(function (e) {
			e.preventDefault();
			var tabId = $(e.target).attr('aria-controls');
			var $tab = $slideHolder.find('[data-tab-id="' + tabId + '"]');
			$slideHolder.find(".nav-tabs .active, .tab-content .active").removeClass("active");
			$(e.target).closest('li').addClass('active');
			$tab.addClass("active");
			liveCode.layout();
		}).first().click();
		$slideHolder.find('div.split-pane').splitPane();
		$slideHolder.find('div.split-pane').on('resize', function(){
			liveCode.layout();
		});
	}

	init();

})();
</script>
</template>
